<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="UTF-8">
<title>Test Page for sap.m.MultiComboBox</title>
<script id="sap-ui-bootstrap" data-sap-ui-theme="sap_bluecrystal"
	data-sap-ui-noConflict="true" data-sap-ui-libs="sap.m"
	src="../../../../resources/sap-ui-core.js">
	
</script>
<link rel="stylesheet"
	href="../../../../resources/sap/ui/thirdparty/qunit.css"
	type="text/css" media="screen" />
<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript" src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>
<script>
	QUnit.config.autostart = false;
	sap.ui.test.qunit.delayTestStart();

	// =========================================================== //
	// Check UX requirements on                                    //
	// https://wiki.wdf.sap.corp/wiki/display/Oberon/Multi+Select  //
	// =========================================================== //

	// =========================================================== //
	// API module                                                  //
	// =========================================================== //

	module("API");

	// ------------------------------ //
	// tests for default values       //
	// ------------------------------ //    
	test("constructor - items : []", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : []
		});

		// arrange
		//oMultiComboBox.placeAt("MultiComboBox-content");
		//sap.ui.getCore().applyChanges();

		// assertions
		strictEqual(oMultiComboBox.getName(), "", 'Default name is ""');
		strictEqual(oMultiComboBox.getVisible(), true, "By default the MultiComboBox control is visible");
		strictEqual(oMultiComboBox.getEnabled(), true, "By default the MultiComboBox control is enabled");
		strictEqual(oMultiComboBox.getWidth(), "100%", 'By default the "width" of the MultiComboBox control is ""');
		strictEqual(oMultiComboBox.getValue(), "", 'By default the "value" of the MultiComboBox control is ""');
		strictEqual(oMultiComboBox.getMaxWidth(), "100%", 'By default the "max-width" of the MultiComboBox control is "100%"');
		deepEqual(oMultiComboBox.getSelectedItems(), [], "By default the selected items of the MultiComboBox control is null");
		deepEqual(oMultiComboBox.getSelectedKeys(), [], 'By default the selected keys of the MultiComboBox control is ""');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - items : [aItems]", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				id : "item00000",
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				id : "my-custom-item11111",
				key : "1",
				text : "item 1",
				enabled : false
			}),

			new sap.ui.core.Item({
				id : "item11111",
				key : "2",
				text : "item 2"
			}) ]
		});

		// arrange
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		sap.ui.getCore().applyChanges();

		// assertions
		strictEqual(oMultiComboBox.getName(), "", 'Default name is ""');
		strictEqual(oMultiComboBox.getVisible(), true, "By default the MultiComboBox control is visible");
		strictEqual(oMultiComboBox.getEnabled(), true, "By default the MultiComboBox control is enabled");
		strictEqual(oMultiComboBox.getWidth(), "100%", 'By default the "width" of the MultiComboBox control is ""');
		strictEqual(oMultiComboBox.getValue(), "", 'By default the "value" of the MultiComboBox control is ""');
		strictEqual(oMultiComboBox.getMaxWidth(), "100%", 'By default the "max-width" of the MultiComboBox control is "100%"');
		deepEqual(oMultiComboBox.getSelectedItems(), [], "By default the selected items of the MultiComboBox control is null");
		deepEqual(oMultiComboBox.getSelectedKeys(), [], 'By default the selected keys of the MultiComboBox control is ""');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - selectedItems : [Item]", function() {

		// system under test
		var oItem = new sap.ui.core.Item({
			key : "0",
			text : "item 0"
		});
		var oMultiComboBox = new sap.m.MultiComboBox({
			selectedItems : [ oItem ]
		});

		// assertions
		strictEqual(oMultiComboBox.getName(), "", 'Default name is ""');
		strictEqual(oMultiComboBox.getVisible(), true, "By default the MultiComboBox control is visible");
		strictEqual(oMultiComboBox.getEnabled(), true, "By default the MultiComboBox control is enabled");
		strictEqual(oMultiComboBox.getWidth(), "100%", 'By default the "width" of the MultiComboBox control is ""');
		strictEqual(oMultiComboBox.getValue(), "", 'By default the "value" of the MultiComboBox control is ""');
		strictEqual(oMultiComboBox.getMaxWidth(), "100%", 'By default the "max-width" of the MultiComboBox control is "100%"');
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ], "By default the selected items of the MultiComboBox control is null");
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ], 'By default the selected keys of the MultiComboBox control is ""');

		// cleanup
		oMultiComboBox.destroy();
	});
	test("constructor - items : [Item], selectedItems : [Item]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],

			selectedItems : [ oItem ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - selectedItems : [Id], items : [Item]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			selectedItems : [ "item00000" ],
			items : [ oItem = new sap.ui.core.Item({
				id : "item00000",
				key : "0",
				text : "item 0"
			}) ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - selectedItems : [Item], items : [Item], setSelectedKey - fireSelectionLiveChange not called", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			selectedItems : [ "item00000" ],
			items : [ oItem = new sap.ui.core.Item({
				id : "item00000",
				key : "0",
				text : "item 0"
			}) ]
		});
		var fnFireSelectionLiveChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");

		// act
		oMultiComboBox.setSelectedKeys([ "0" ]);

		// assertions
		strictEqual(fnFireSelectionLiveChangeSpy.callCount, 0, "The change event was not fired");
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "0" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - selectedItems : [Item], items : [Item], removeSelectedKey - fireSelectionLiveChange not called", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			selectedItems : [ "item00000" ],
			items : [ oItem = new sap.ui.core.Item({
				id : "item00000",
				key : "0",
				text : "item 0"
			}) ]
		});

		var fnFireSelectionLiveChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");

		// act
		oMultiComboBox.removeSelectedKeys([ "0" ]);

		// assertions
		strictEqual(fnFireSelectionLiveChangeSpy.callCount, 0, "The change event was fired");
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - items:[Items] - check selectedKeys", function() {

		// system under test
		var oItem0, oItem1, oItem2;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem0 = new sap.ui.core.Item({
				id : "item00000",
				key : "0",
				text : "item 0"
			}),

			oItem1 = new sap.ui.core.Item({
				id : "my-custom-item11111",
				key : "1",
				text : "item 1",
				enabled : false
			}),

			oItem2 = new sap.ui.core.Item({
				id : "item11111",
				key : "2",
				text : "item 2"
			}) ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		oMultiComboBox.setSelectedKeys([ "0" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "0" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem0 ]);

		oMultiComboBox.setSelectedKeys([ "0", "1" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "0", "1" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem0, oItem1 ]);

		oMultiComboBox.setSelectedKeys([ null ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		oMultiComboBox.setSelectedKeys([ "2", null, "1" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "2", "1" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem2, oItem1 ]);

		oMultiComboBox.setSelectedKeys([ "0" ]);
		oMultiComboBox.setSelectedKeys([ "dummy" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "dummy" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		oMultiComboBox.setSelectedKeys([ "0" ]);
		oMultiComboBox.setSelectedKeys([ "" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		oMultiComboBox.setSelectedKeys([ "0", "1" ]);
		oMultiComboBox.removeSelectedKeys([ "1" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "0" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem0 ]);

		oMultiComboBox.removeSelectedKeys([ "dummy" ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "0" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem0 ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// maxWidth()              //
	// ------------------------------ //

	test("method: xxxMaxWidth() - maxWidth", function() {

		// system under test              
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],
			maxWidth : "300px"
		});

		// arrange
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		// assertions
		strictEqual(oMultiComboBox.getMaxWidth(), "300px");
		strictEqual(oMultiComboBox.getDomRef().style.maxWidth, "300px");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: xxxMaxWidth() - maxWidth", function() {

		// system under test              
		var oMultiComboBox = new sap.m.MultiComboBox();

		// arrange
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		// act 
		oMultiComboBox.setMaxWidth("30%");
		sap.ui.getCore().applyChanges();

		// assertions
		strictEqual(oMultiComboBox.getMaxWidth(), "30%");
		strictEqual(oMultiComboBox.getDomRef().style.maxWidth, "30%");

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// getSelectedItems()              //
	// ------------------------------ //

	test("method: getSelectedXXX() - items : [Item], selectedItems : [Item]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],

			selectedItems : [ oItem ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});
	test("method: getSelectedXXX() - items : [Item], selectedItems : [Item] - setSelectedItems(DummyItem)", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],

			selectedItems : [ oItem ]
		});
		oMultiComboBox.setSelectedItems([ new sap.ui.core.Item({
			key : "Dummy",
			text : "Dummy item 1"
		}) ]);

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});
	test("method: getSelectedXXX() - items : [Item], selectedItems : DummyId", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],

			selectedItems : "Dummy"
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});
	test("method: getSelectedXXX() - items : [Items], selectedItems : [Items]", function() {

		// system under test
		var oItem, oItem2;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			oItem2 = new sap.ui.core.Item({
				id : "myItem0",
				key : "2",
				text : "item 2"
			}),

			new sap.ui.core.Item({
				key : "3",
				text : "item 3"
			}) ],

			selectedItems : [ oItem, oItem2 ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem, oItem2 ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey(), oItem2.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedXXX() - selectedItems : Id, items : [Items]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({

			selectedItems : "myItem2",

			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			oItem = new sap.ui.core.Item({
				id : "myItem2",
				key : "2",
				text : "item 2"
			}),

			new sap.ui.core.Item({
				key : "3",
				text : "item 3"
			}) ]
		});

		// arrange
		//oMultiComboBox.placeAt("MultiComboBox-content");
		//sap.ui.getCore().applyChanges();

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedXXX() - selectedItems : [dummy], items : [Items]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({

			selectedItems : "dummy",

			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			oItem = new sap.ui.core.Item({
				id : "myItem2",
				key : "2",
				text : "item 2"
			}),

			new sap.ui.core.Item({
				key : "3",
				text : "item 3"
			}) ]
		});

		// arrange
		//oMultiComboBox.placeAt("MultiComboBox-content");
		//sap.ui.getCore().applyChanges();

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});
	test("method: getSelectedXXX() - items : []", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : []
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedXXX() - items, selectedItems : null", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			new sap.ui.core.Item({
				key : "2",
				text : "item 2"
			}) ],

			selectedItems : null
		});

		// arrange
		//oMultiComboBox.placeAt("MultiComboBox-content");
		//sap.ui.getCore().applyChanges();

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test('method: getSelectedXXX() - items - addSelectedItem', function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			new sap.ui.core.Item({
				key : "2",
				text : "item 2"
			}) ]
		});
		oMultiComboBox.addSelectedItem(oItem);
		oMultiComboBox.addSelectedItem(oItem);

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// addItem                        //
	// ------------------------------ //

	test("method: addItem()", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox();

		// arrange
		var fnAddAggregationSpy = this.spy(oMultiComboBox, "addAggregation");
		var fnListAddAggregationSpy = this.spy(oMultiComboBox._oList, "addAggregation");
		var fnAddItemSpy = this.spy(oMultiComboBox, "addItem");
		var oItem = new sap.ui.core.Item({
			key : "0",
			text : "item 0"
		});

		// act
		oMultiComboBox.addItem(oItem);

		// assertions
		ok(fnAddAggregationSpy.calledWith("items", oItem), "sap.m.MultiComboBox.addAggregation() method was called with the expected arguments");
		ok(fnListAddAggregationSpy.calledWith("items", oItem._oListItem), "sap.m.List.addAggregation() method was called with the expected arguments");
		ok(fnAddItemSpy.returned(oMultiComboBox));
		deepEqual(oMultiComboBox.getAggregation("items"), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: addItem() - twice", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox();

		// arrange
		var fnAddAggregationSpy = this.spy(oMultiComboBox, "addAggregation");
		var fnListAddAggregationSpy = this.spy(oMultiComboBox._oList, "addAggregation");
		var fnAddItemSpy = this.spy(oMultiComboBox, "addItem");
		var oItem = new sap.ui.core.Item({
			key : "0",
			text : "item 0"
		});

		// act
		oMultiComboBox.addItem(oItem);
		oMultiComboBox.addItem(oItem);

		// assertions
		ok(fnAddAggregationSpy.calledWith("items", oItem), "sap.m.MultiComboBox.addAggregation() method was called with the expected arguments");
		ok(fnListAddAggregationSpy.calledWith("items", oItem._oListItem), "sap.m.List.addAggregation() method was called with the expected arguments");
		ok(fnAddItemSpy.returned(oMultiComboBox));
		deepEqual(oMultiComboBox.getAggregation("items"), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// removeXXX                      //
	// ------------------------------ //
	test("method: removeSelectedItem()", function() {

		// system under test
		var oItem, oItemRemoved;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange

		// act
		oItemRemoved = oMultiComboBox.removeSelectedItem(oItem);

		// assertions
		strictEqual(oItem, oItemRemoved);
		deepEqual(oMultiComboBox.getAggregation("items"), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		deepEqual(oMultiComboBox._oTokenizer.getTokens(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: removeAllSelectedItems()", function() {

		// system under test
		var oItem, aItems;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange

		// act
		aItems = oMultiComboBox.removeAllSelectedItems();

		// assertions
		deepEqual(aItems, [ oItem ]);
		deepEqual(oMultiComboBox.getAggregation("items"), [ oItem ]);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		deepEqual(oMultiComboBox._oTokenizer.getTokens(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: removeItem()", function() {

		// system under test
		var oItem, oItemRemoved;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange

		// act
		oItemRemoved = oMultiComboBox.removeItem(oItem);

		// assertions
		strictEqual(oItemRemoved, oItem);
		deepEqual(oMultiComboBox.getAggregation("items"), []);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		deepEqual(oMultiComboBox._oTokenizer.getTokens(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: removeAllItems()", function() {

		// system under test
		var oItem, aItems;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange

		// act
		aItems = oMultiComboBox.removeAllItems();

		// assertions
		deepEqual(aItems, [ oItem ]);
		deepEqual(oMultiComboBox.getAggregation("items"), []);
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		deepEqual(oMultiComboBox._oTokenizer.getTokens(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// insertItem                     //
	// ------------------------------ //

	test("method: insertItem()", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox();

		// arrange
		var fnInsertAggregation = this.spy(oMultiComboBox, "insertAggregation");
		var fnListInsertAggregation = this.spy(oMultiComboBox._oList, "insertAggregation");
		var fnInsertItem = this.spy(oMultiComboBox, "insertItem");
		var oItem = new sap.ui.core.Item({
			key : "0",
			text : "item 0"
		});

		// act
		oMultiComboBox.insertItem(oItem, 0);

		// assertions
		ok(fnInsertAggregation.calledWith("items", oItem, 0), "oMultiComboBox.insertAggregation() method was called with the expected arguments");
		ok(fnListInsertAggregation.calledWith("items", oItem._oListItem, 0), "oList.insertAggregation() method was called with the expected arguments");
		ok(fnInsertItem.returned(oMultiComboBox), 'oMultiComboBox.insertAggregation() method return the "this" reference');

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// setSelectedItems()              //
	// ------------------------------ //

	test("method: setSelectedItems() - [null] : should give an warning when called with faulty parameter", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox();

		// arrange
		var fnSetPropertySpy = this.spy(oMultiComboBox, "setProperty");
		var fnSetAssociationSpy = this.spy(oMultiComboBox, "setAssociation");
		var fnErrorSpy = this.spy(jQuery.sap.log, "warning");
		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnSetSelectedItemsSpy = this.spy(oMultiComboBox, "setSelectedItems");

		// act
		oMultiComboBox.setSelectedItems([ null ]);

		// assertions
		strictEqual(fnErrorSpy.callCount, 1, "jQuery.sap.log.warning() method was called");
		strictEqual(fnSetPropertySpy.callCount, 0, "sap.m.MultiComboBox.prototype.setProperty() method was not called");
		strictEqual(fnSetAssociationSpy.callCount, 0, "sap.m.MultiComboBox.prototype.setAssociation() method was not called");
		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");
		//strictEqual(oMultiComboBox.getSelectedItemId(), "");                           
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		ok(fnSetSelectedItemsSpy.returned(oMultiComboBox), 'sap.m.MultiComboBox.prototype.setSelectedItems() method return the "this" reference');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: setSelectedItems() - [two items with same text] : should take over", function() {

		// system under test
		var oItem1, oItem2;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem1 = new sap.ui.core.Item({
				key : "0",
				text : "same text"
			}),

			oItem2 = new sap.ui.core.Item({
				key : "1",
				text : "same item"
			}),

			new sap.ui.core.Item({
				key : "2",
				text : "item"
			}) ]
		});

		oMultiComboBox.setSelectedItems([ oItem1, oItem2 ]);
		// arrange
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		// assertions
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem1, oItem2 ], "Should have both items");
		strictEqual(oMultiComboBox._oTokenizer.getTokens().length, 2, "should have two item");

		// cleanup
		oMultiComboBox.destroy();
	});
	test("method: setSelectedKeys() - {} : should give an warning when called with faulty parameter", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox();

		// arrange
		var fnSetPropertySpy = this.spy(oMultiComboBox, "setProperty");
		var fnSetAssociationSpy = this.spy(oMultiComboBox, "setAssociation");
		var fnErrorSpy = this.spy(jQuery.sap.log, "warning");
		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnSetSelectedKeysSpy = this.spy(oMultiComboBox, "setSelectedKeys");

		// act
		oMultiComboBox.setSelectedKeys([ null ]);

		// assertions
		strictEqual(fnErrorSpy.callCount, 1, "jQuery.sap.log.warning() method was called");
		strictEqual(fnSetPropertySpy.callCount, 0, "sap.m.MultiComboBox.prototype.setProperty() method was not called");
		strictEqual(fnSetAssociationSpy.callCount, 0, "sap.m.MultiComboBox.prototype.setAssociation() method was not called");
		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");
		//strictEqual(oMultiComboBox.getSelectedItemId(), "");                           
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		ok(fnSetSelectedKeysSpy.returned(oMultiComboBox), 'sap.m.MultiComboBox.prototype.setSelectedKeys() method return the "this" reference');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: setSelectedItems() - [oItem]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			oItem = new sap.ui.core.Item({
				id : "myItem1",
				key : "1",
				text : "item 1"
			}),

			new sap.ui.core.Item({
				key : "2",
				text : "item 2",
				enabled : false
			}) ]
		});

		// arrange
		//var fnSetPropertySpy = this.spy(oMultiComboBox, "setProperty");
		var fnAddAssociationSpy = this.spy(oMultiComboBox, "addAssociation");
		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnSetSelectedItemsSpy = this.spy(oMultiComboBox, "setSelectedItems");

		// act
		oMultiComboBox.setSelectedItems([ oItem ]);

		// assertions
		//ok(fnSetPropertySpy.calledWith("selectedKeys", [ oItem.getKey() ], true));
		//ok(fnSetPropertySpy.calledWith("selectedItemId", "myItem1"));
		ok(fnAddAssociationSpy.calledWith("selectedItems", oItem));
		ok(fnSetSelectedItemsSpy.returned(oMultiComboBox), 'sap.m.MultiComboBox.prototype.setSelectedItems() method return the "this" reference');

		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);

		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: setSelectedItems() - [Id]", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			oItem = new sap.ui.core.Item({
				id : "myItem1-1",
				key : "1",
				text : "item 1"
			}),

			new sap.ui.core.Item({
				key : "2",
				text : "item 2",
				enabled : false
			}) ]
		});

		// arrange
		var fnAddAssociationSpy = this.spy(oMultiComboBox, "addAssociation");
		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnSetSelectedItemsSpy = this.spy(oMultiComboBox, "setSelectedItems");

		// act
		oMultiComboBox.setSelectedItems([ oItem.getId() ]);

		// assertions
		ok(fnAddAssociationSpy.calledWith("selectedItems", oItem));
		ok(fnSetSelectedItemsSpy.returned(oMultiComboBox), 'sap.m.MultiComboBox.prototype.setSelectedItems() method return the "this" reference');

		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");

		//sap.ui.getCore().applyChanges();
		//strictEqual(oMultiComboBox.getValue(), "item 1");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Firing event: setSelectedItems() set the selected item when the MultiComboBox popup menu is open", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			oItem = new sap.ui.core.Item({
				key : "2",
				text : "item 2"
			}) ]
		});

		// arrange
		oMultiComboBox.setSelectedKeys([ "1" ]);
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		oMultiComboBox.open();

		// act
		oMultiComboBox.setSelectedKeys([ oItem.getKey() ]);

		// assertion
		// 1. the popup should not be closed
		// 2. new selection should be took over
		deepEqual(oMultiComboBox.getSelectedKeys(), [ oItem.getKey() ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedKeys()", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}) ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedKeys()", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			oItem = new sap.ui.core.Item({
				key : "2",
				text : "item 2"
			}),

			new sap.ui.core.Item({
				key : "3",
				text : "item 3"
			}) ],

			selectedItems : oItem.getId()
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "2" ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedKeys()", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			selectedItems : "myItem3",

			items : [ new sap.ui.core.Item({
				key : "0",
				text : "item 0"
			}),

			new sap.ui.core.Item({
				key : "1",
				text : "item 1"
			}),

			new sap.ui.core.Item({
				key : "2",
				text : "item 2"
			}),

			new sap.ui.core.Item({
				id : "myItem3",
				key : "3",
				text : "item 3"
			}) ]
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "3" ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedKeys()", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : []
		});

		// assertions
		deepEqual(oMultiComboBox.getSelectedKeys(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("method: getSelectedKeys()", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "25",
				text : "item 25"
			}),

			new sap.ui.core.Item({
				key : "26",
				text : "item 26"
			}),

			new sap.ui.core.Item({
				key : "27",
				text : "item 27"
			}) ],

			selectedItems : null
		});

		// assertions        
		deepEqual(oMultiComboBox.getSelectedKeys(), []);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - items:[] selectedKeys[sKey]", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : []
		});
		oMultiComboBox.setSelectedKeys([ "01" ]);

		// assertions        
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "01" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - items:[] selectedKeys[sKey] - addItem(oItem)", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : []
		});
		oMultiComboBox.setSelectedKeys([ "01" ]);

		// arrange
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.addItem(oItem = new sap.ui.core.Item({
			key : "01",
			text : "selected item"
		}));
		oMultiComboBox.addItem(new sap.ui.core.Item({
			key : "02",
			text : "item"
		}));
		sap.ui.getCore().applyChanges();

		// assertions        
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "01" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	test("constructor - items:[] selectedItems[oItem] selectedKeys[sKey] - addItem(oItem)", function() {

		// system under test
		var oItem1, oItem2;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [],
			selectedItems : [ oItem1 = new sap.ui.core.Item({
				key : "01",
				text : "selected item"
			}) ]
		});
		oMultiComboBox.addSelectedKeys([ "02" ]);

		// arrange
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.addItem(oItem1);
		oMultiComboBox.addItem(oItem2 = new sap.ui.core.Item({
			key : "02",
			text : "selected item"
		}));
		sap.ui.getCore().applyChanges();

		// assertions        
		deepEqual(oMultiComboBox.getSelectedKeys(), [ "01", "02" ]);
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem1, oItem2 ]);

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// Scenarios - specification      //
	// ------------------------------ //

	test("Scenario 'FIXED_CHAR': Letter is only then accepted if at least one list item matches the new value.", function() {

		// system under test
		var oItem;
		var sInitValue = "Algeri";
		var oMultiComboBox = new sap.m.MultiComboBox({
			value : sInitValue,
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		// act
		sap.ui.test.qunit.triggerKeypress(oMultiComboBox.getFocusDomRef(), "b");

		// assertions
		strictEqual(oMultiComboBox.getValue(), sInitValue, "Input value is returned to the inital value after wrong character was typed");
		strictEqual(oMultiComboBox.getFocusDomRef().value, oMultiComboBox.getValue(), "Dom value and value property are same after wrong character was typed");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'TOKEN_ORDER': Order of tokens is the order how the items were selected", function() {

		// system under test
		var oItem1, oItem2, oItem3;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem1 = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}), oItem2 = new sap.ui.core.Item({
				key : "AR",
				text : "Argentina"
			}), oItem3 = new sap.ui.core.Item({
				key : "AU",
				text : "Australia"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		// act
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem1.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem2.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem3.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		// assertions
		var aTokens = oMultiComboBox._oTokenizer.getTokens();
		strictEqual(aTokens[0].getKey(), oItem1.getKey());
		strictEqual(aTokens[1].getKey(), oItem2.getKey());
		strictEqual(aTokens[2].getKey(), oItem3.getKey());

		// arrange   
		oMultiComboBox.removeAllSelectedItems();

		// act
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem3.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem2.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem1.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		// assertions
		aTokens = oMultiComboBox._oTokenizer.getTokens();
		strictEqual(aTokens[0].getKey(), oItem3.getKey());
		strictEqual(aTokens[1].getKey(), oItem2.getKey());
		strictEqual(aTokens[2].getKey(), oItem1.getKey());

		// cleanup
		oMultiComboBox.destroy();
	});

	// ------------------------------ //
	// Scenarios - event handling     //
	// ------------------------------ //

	test("Scenario 'EVENT_VALUE_ENTER': 'Algeria' + ENTER", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem.getText());
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER);

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_VALUE_DUMMY_ENTER': 'dummy' + ENTER", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), 'dummy');
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER); //onsapenter

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 0, "The selection change event was not fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was not fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_VALUE_SELECT_ENTER': 'Algeria' + select 'lgeria' + 'ustralia' + ENTER", function() {

		// system under test
		var oItem1, oItem2;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem1 = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}), oItem2 = new sap.ui.core.Item({
				key : "AU",
				text : "Australia"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem1.getText());
		oMultiComboBox.selectText(1, oMultiComboBox.getValue().length);
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), "ustralia");

		// assertions
		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 0, "The selection change event was not fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was not fired");
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER);

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 0, "The selection change event was not fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was not fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_VALUE_PASTE': CTRL+V 'Algeria' + ENTER", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerEvent("paste", oMultiComboBox.getFocusDomRef(), {
			originalEvent : {
				clipboardData : {
					getData : function() {
						return "Algeria";
					}
				}
			}
		});
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), "Algeria"); // need to add the value with triggerCharacterInput because triggerEvent("paste") does not set value

		// assertions
		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was not fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 0, "The selection change event was not fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was not fired");

		// act
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.ENTER);

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was not fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was not fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_VALUE_FOCUSOUT': 'Algeria' + FOCUSOUT", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), oItem.getText());
		sap.ui.test.qunit.triggerEvent("focusout", oMultiComboBox.getDomRef());

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 0, "The selection change event was not fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was not fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_TOKEN_BACKSPACE': Token 'Algeria' + BACKSPACE + BACKSPACE", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.BACKSPACE); // select last token
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.BACKSPACE); // delete selected token

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_TOKEN_DELETE': Token 'Algeria' + BACKSPACE + DELETE", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.BACKSPACE); // select last token
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.DELETE); // delete selected token

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_TOKENS_DELETE': 3 Tokens + CTRL+A + DELETE", function() {

		// system under test
		var oItem1, oItem2, oItem3;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem1 = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}), oItem2 = new sap.ui.core.Item({
				key : "AR",
				text : "Argentina"
			}), oItem3 = new sap.ui.core.Item({
				key : "AU",
				text : "Australia"
			}) ],
			selectedItems : [ oItem1, oItem2, oItem3 ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.A, false, false, true); // select all tokens
		sap.ui.test.qunit.triggerKeydown(oMultiComboBox.getDomRef(), jQuery.sap.KeyCodes.DELETE); // delete selected tokens

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 3, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 3, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 3, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_TOKEN_DELETE_BUTTON': Token 'Algeria' + delete button on token", function() {

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act
		var oToken = jQuery.find(".sapMToken")[0];
		var oTokenIcon = jQuery.find(".sapMTokenIcon")[0];
		sap.ui.test.qunit.triggerTouchEvent("touchend", oToken, {
			target : oTokenIcon,
			button : 0
		});

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_VALUE_ESCAPE': 'Algeria' change to 'Dummy' + ESCAPE", function() {

		// system under test
		var sInitValue = "Algeria";
		var oMultiComboBox = new sap.m.MultiComboBox({
			value : sInitValue,
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");
		var fnFireEventSpy = this.spy(oMultiComboBox, "fireEvent");

		// act
		oMultiComboBox.getFocusDomRef().value = "Dummy";

		// assertion
		notEqual(oMultiComboBox.getFocusDomRef().value, oMultiComboBox.getValue(), "Before escape call dom value and value property are not same.");

		// act
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ESCAPE);

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);

		strictEqual(oMultiComboBox.getValue(), sInitValue, "Input value is returned to the inital value after escape.");
		strictEqual(oMultiComboBox.getFocusDomRef().value, oMultiComboBox.getValue(), "Dom value and value property are same after escape.");
		ok(fnFireEventSpy.calledWith("liveChange"), "Private liveChange event is fired on escape");
		strictEqual(fnFireEventSpy.callCount, 1, "LiveChange event is fired once");

		strictEqual(fnFireChangeSpy.callCount, 0, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 0, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Scenario 'EVENT_VALUE_ENTER_OPENLIST': 'alg' + ALT+DOWNKEY + ENTER + ALT+UPKEY", function() {
		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act - 'alg' + OpenList + Enter
		sap.ui.test.qunit.triggerCharacterInput(oMultiComboBox.getFocusDomRef(), "alg");
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ENTER);
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true);
		this.clock.tick(500);

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario 'EVENT_SELECTION_SPACE': ALT+DOWNKEY + SelectItem + ALT+UPKEY", function() {
		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act - 'alg' + OpenList + TAP
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);
		this.clock.tick(500);
		var oDomListItem = jQuery.find(".sapMMultiComboBoxItem")[0];
		var oListItem = sap.ui.getCore().byId(oDomListItem.id);
		sap.ui.test.qunit.triggerTouchEvent("tap", oDomListItem, {
			srcControl : oListItem
		});

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), [ oItem ]);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was fired");

		// act - CloseList
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true);
		this.clock.tick(500);

		// assertions
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario 'EVENT_DESELECTION_SPACE': SelectedItem + ALT+DOWNKEY + DeselectItem + ALT+UPKEY", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oItem;
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ oItem = new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ],
			selectedItems : [ oItem ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnFireChangeSpy = this.spy(oMultiComboBox, "fireChange");
		var fnFireSelectionChangeSpy = this.spy(oMultiComboBox, "fireSelectionChange");
		var fnFireSelectionFinishSpy = this.spy(oMultiComboBox, "fireSelectionFinish");

		// act - 'alg' + OpenList + TAP
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);
		this.clock.tick(500);
		var oDomListItem = jQuery.find(".sapMMultiComboBoxItem")[0];
		var oListItem = sap.ui.getCore().byId(oDomListItem.id);
		sap.ui.test.qunit.triggerTouchEvent("tap", oDomListItem, {
			srcControl : oListItem
		});

		// assertions        
		deepEqual(oMultiComboBox.getSelectedItems(), []);
		strictEqual(fnFireChangeSpy.callCount, 1, "The change event was fired");
		strictEqual(fnFireSelectionChangeSpy.callCount, 1, "The selection change event was fired");
		strictEqual(fnFireSelectionFinishSpy.callCount, 0, "The selection finish event was fired");

		// act - CloseList
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true);
		this.clock.tick(500);

		// assertions
		strictEqual(fnFireSelectionFinishSpy.callCount, 1, "The selection finish event was fired");

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario CLICK_INPUT: tap into control", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		var fnTapSpy = this.spy(oMultiComboBox, "ontap");
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act - clicking on control
		sap.ui.test.qunit.triggerTouchEvent("tap", oMultiComboBox.getFocusDomRef(), {
			target : oMultiComboBox.getFocusDomRef()
		});
		this.clock.tick(500);

		// assertions
		strictEqual(fnTapSpy.callCount, 1, "ontap event was called exactly once on " + oMultiComboBox);
		strictEqual(fnOpenSpy.callCount, 0, "open was not called");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Popup is closed");
		ok(!oMultiComboBox.isOpen(), "oMultiComboBox is closed");
		ok(!oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must not have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	// --------------------------------- //
	// Scenarios - opening dropdown list //
	// --------------------------------- // 

	test("Scenario OPEN_ALTDOWN", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnShowSpy = this.spy(oMultiComboBox, "onsapshow");
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);
		this.clock.tick(500);

		// assertions                     
		strictEqual(fnShowSpy.callCount, 1, "onsapshow was called exactly once");
		strictEqual(fnOpenSpy.callCount, 1, "openwas called exactly once");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
		ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');
		ok(!oMultiComboBox._isListInSuggestMode(), 'Complete list is open');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario OPEN_ALTUP", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnHideSpy = this.spy(oMultiComboBox, "onsaphide");
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true);
		this.clock.tick(500);

		// assertions                     
		strictEqual(fnHideSpy.callCount, 1, "onsaphide was called exactly once");
		strictEqual(fnOpenSpy.callCount, 1, "openwas called exactly once");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
		ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');
		ok(!oMultiComboBox._isListInSuggestMode(), 'Complete list is open');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario OPEN_F4", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();

		var fnShowSpy = this.spy(oMultiComboBox, "onsapshow");
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.F4);
		this.clock.tick(500);

		// assertions                     
		strictEqual(fnShowSpy.callCount, 1, "onsapshow was called exactly once");
		strictEqual(fnOpenSpy.callCount, 1, "open was called exactly once");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
		ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');
		ok(!oMultiComboBox._isListInSuggestMode(), 'Complete list is open');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario OPEN_ARROW: tap on arrow", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		var fnTapSpy = this.spy(oMultiComboBox, "ontap");
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act - clicking on arrow
		sap.ui.test.qunit.triggerTouchEvent("tap", oMultiComboBox.getDomRef("arrow"), {
			target : oMultiComboBox.getDomRef("arrow")
		});
		this.clock.tick(500);

		// assertions
		strictEqual(fnTapSpy.callCount, 1, "ontap event was called exactly once on Arrow");
		strictEqual(fnOpenSpy.callCount, 1, "open was called exactly once");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
		ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');
		ok(!oMultiComboBox._isListInSuggestMode(), 'Complete list is open');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario OPEN_VALUE: Typing valid letters into InputField", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			value : "algeria",
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}), new sap.ui.core.Item({
				key : "AR",
				text : "Argentina"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act
		sap.ui.qunit.QUnitUtils.triggerEvent("input", oMultiComboBox.getFocusDomRef());
		this.clock.tick(500);

		// assertions
		strictEqual(fnOpenSpy.callCount, 1, "open was called exactly once");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
		ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');
		ok(oMultiComboBox._isListInSuggestMode(), 'Suggest list is open');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario OPEN_SUGGEST_SPACE: Pushing SPACE on item in suggest list - suggest list is closing first and complete list is opening then", function() {

		var oSystem = {
			desktop : true,
			phone : false,
			tablet : false
		};
		this.stub(sap.ui.Device, "system", oSystem);
		this.stub(jQuery.device, "is", oSystem);

		// system under test              
		var oMultiComboBox = new sap.m.MultiComboBox({
			value : "al",
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}), new sap.ui.core.Item({
				key : "AR",
				text : "Argentina"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

		// act
		sap.ui.qunit.QUnitUtils.triggerEvent("input", oMultiComboBox.getFocusDomRef());
		this.clock.tick(500);

		// assertions
		ok(oMultiComboBox._isListInSuggestMode(), 'Suggest list is open');

		// act
		var oDomListItem = jQuery.find(".sapMMultiComboBoxItem")[0];
		sap.ui.test.qunit.triggerKeyup(oDomListItem, jQuery.sap.KeyCodes.SPACE);
		this.clock.tick(500);

		// assertions
		strictEqual(fnOpenSpy.callCount, 2, "open was called exactly once");
		strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
		ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("Scenario OPEN_SUGGEST_ARROW: Pushing twice ALT+DOWN etc. in suggest list - suggest list is closing first and complete list is opening then",
			function() {

				var oSystem = {
					desktop : true,
					phone : false,
					tablet : false
				};
				this.stub(sap.ui.Device, "system", oSystem);
				this.stub(jQuery.device, "is", oSystem);

				// system under test              
				var oMultiComboBox = new sap.m.MultiComboBox({
					value : "al",
					items : [ new sap.ui.core.Item({
						key : "DZ",
						text : "Algeria"
					}), new sap.ui.core.Item({
						key : "AR",
						text : "Argentina"
					}) ]
				});

				// arrange          
				oMultiComboBox.placeAt("MultiComboBox-content");
				sap.ui.getCore().applyChanges();
				var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");

				// act
				sap.ui.qunit.QUnitUtils.triggerEvent("input", oMultiComboBox.getFocusDomRef());
				this.clock.tick(500);

				// assertions
				ok(oMultiComboBox._isListInSuggestMode(), 'Suggest list is open');

				// act
				sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true); // close list
				this.clock.tick(500);
				sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_UP, false, true); // open list
				this.clock.tick(500);

				// assertions
				strictEqual(fnOpenSpy.callCount, 2, "open was called exactly twice");
				strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.OPEN, "Popup is open");
				ok(oMultiComboBox.isOpen(), "oMultiComboBox is open");
				ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
						+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');
				ok(!oMultiComboBox._isListInSuggestMode(), 'Complete list is open');

				// cleanup
				oMultiComboBox.destroy();
				this.clock.reset();
			});

	// --------------------------------- //
	// Scenarios - closing dropdown list //
	// --------------------------------- // 

	/*test("Scenario CLOSE_FOCUSLEAVE", function() {

	      // system under test
	      var oMultiComboBox = new sap.m.MultiComboBox({
	             items : [ new sap.ui.core.Item({
	                    key : "DZ",
	                    text : "Algeria"
	             }) ]
	      });

	      // arrange          
	      oMultiComboBox.placeAt("MultiComboBox-content");
	      sap.ui.getCore().applyChanges();
	      oMultiComboBox.focus();

	      var fnOpenSpy = this.spy(oMultiComboBox.getPopup(), "open");
	      var fnCloseSpy = this.spy(oMultiComboBox.getPopup(), "close");

	      // act       
	      oMultiComboBox.open();
	      this.clock.tick(1000);
	      sap.ui.test.qunit.triggerEvent("focusout", oMultiComboBox.getFocusDomRef());
	      this.clock.tick(1000);

	      // assertions                                  
	      strictEqual(fnCloseSpy.callCount, 1, "close was called exactly once");
	      strictEqual(oMultiComboBox.getPopup().oPopup.getOpenState(), sap.ui.core.OpenState.CLOSED, "Popup is closed");
	      ok(!oMultiComboBox.isOpen(), "oMultiComboBox is closed");
	      ok(!oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must not have the css class '
	                    + sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');

	      // cleanup
	      oMultiComboBox.destroy();
	       this.clock.reset();
	});*/

	// --------------------------------- //
	// Arrow - pressed state             //
	// --------------------------------- // 
	test("Arrow - pressed on arrow", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		var oDomRefArrow = oMultiComboBox.getDomRef("arrow");
		sap.ui.test.qunit.triggerTouchEvent("touchstart", oDomRefArrow, {
			target : oDomRefArrow
		});

		// assertions                                  
		ok(!oMultiComboBox.isOpen(), "oMultiComboBox is closed");
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("Arrow - pressed on control", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		var oDomRef = oMultiComboBox.getFocusDomRef();
		sap.ui.test.qunit.triggerTouchEvent("touchstart", oDomRef, {
			target : oDomRef
		});

		// assertions                                  
		ok(!oMultiComboBox.isOpen(), "oMultiComboBox is closed");
		ok(!oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Pressed"), 'The MultiComboBox must not have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Pressed');

		// cleanup
		oMultiComboBox.destroy();
	});

	// --------------------------------- //
	// Focus - border                    //
	// --------------------------------- // 
	test("FocusBorder - pressed on control", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		var oDomRef = oMultiComboBox.getFocusDomRef();
		sap.ui.test.qunit.triggerTouchEvent("touchstart", oDomRef, {
			target : oDomRef
		});

		// assertions                                  
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Focused"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Focused');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("FocusBorder - pressed on arrow", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		var oDomRefArrow = oMultiComboBox.getDomRef("arrow");
		sap.ui.test.qunit.triggerTouchEvent("touchstart", oDomRefArrow, {
			target : oDomRefArrow
		});

		// assertions                                  
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Focused"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Focused');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("FocusBorder - focus on list item", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		sap.ui.test.qunit.triggerKeyboardEvent(oMultiComboBox.getFocusDomRef(), jQuery.sap.KeyCodes.ARROW_DOWN, false, true);
		this.clock.tick(500);
		var oDomListItem = jQuery.find(sap.m.MultiComboBoxRenderer.DOT_CSS_CLASS + "Item")[0];
		var oListItem = sap.ui.getCore().byId(oDomListItem.id);
		sap.ui.test.qunit.triggerTouchEvent("tap", oDomListItem, {
			srcControl : oListItem
		});

		// assertions                                  
		ok(oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Focused"), 'The MultiComboBox must have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Focused');

		// cleanup
		oMultiComboBox.destroy();
		this.clock.reset();
	});

	test("FocusBorder - arrow + leave", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		var oDomRefArrow = oMultiComboBox.getDomRef("arrow");
		sap.ui.test.qunit.triggerTouchEvent("touchstart", oDomRefArrow, {
			target : oDomRefArrow
		});
		sap.ui.test.qunit.triggerEvent("focusout", oMultiComboBox.getDomRef());

		// assertions                                  
		ok(!oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Focused"), 'The MultiComboBox must not have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Focused');

		// cleanup
		oMultiComboBox.destroy();
	});

	test("FocusBorder - control + leave", function() {

		// system under test
		var oMultiComboBox = new sap.m.MultiComboBox({
			items : [ new sap.ui.core.Item({
				key : "DZ",
				text : "Algeria"
			}) ]
		});

		// arrange          
		oMultiComboBox.placeAt("MultiComboBox-content");
		sap.ui.getCore().applyChanges();
		oMultiComboBox.focus();

		// act
		var oDomRef = oMultiComboBox.getFocusDomRef();
		sap.ui.test.qunit.triggerTouchEvent("touchstart", oDomRef, {
			target : oDomRef
		});
		sap.ui.test.qunit.triggerEvent("focusout", oDomRef);

		// assertions                                  
		ok(!oMultiComboBox.$().hasClass(sap.m.MultiComboBoxRenderer.CSS_CLASS + "Focused"), 'The MultiComboBox must not have the css class '
				+ sap.m.MultiComboBoxRenderer.CSS_CLASS + 'Focused');

		// cleanup
		oMultiComboBox.destroy();
	});
</script>
</head>
<body id="body" class="sapUiBody">
	<h1 id="qunit-header">QUnit tests: sap.m.MultiComboBox</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<ol id="qunit-tests"></ol>
	<div id="MultiComboBox-content" class="select-content"></div>
</body>
</html>


