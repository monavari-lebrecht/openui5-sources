/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP AG or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
jQuery.sap.declare("sap.m.DateRangeSelection");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.m.DatePicker");sap.m.DatePicker.extend("sap.m.DateRangeSelection",{metadata:{library:"sap.m",properties:{"delimiter":{type:"string",group:"Misc",defaultValue:'-'},"secondDateValue":{type:"object",group:"Data",defaultValue:null},"from":{type:"object",group:"Misc",defaultValue:null,deprecated:true},"to":{type:"object",group:"Misc",defaultValue:null,deprecated:true}},events:{"change":{}}}});sap.m.DateRangeSelection.M_EVENTS={'change':'change'};(function(){sap.m.DateRangeSelection.prototype.init=function(){sap.m.DatePicker.prototype.init.apply(this,arguments);this._bIntervalSelection=true};sap.m.DateRangeSelection.prototype._getPlaceholder=function(){var p=this.getPlaceholder();if(!p){p=this.getDisplayFormat();if(!p){p="medium"}if(p==="short"||p==="medium"||p==="long"){var l=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var L=sap.ui.core.LocaleData.getInstance(l);p=L.getDatePattern(p)}if(this.getDelimiter()&&this.getDelimiter()!==""){p=p+" "+this.getDelimiter()+" "+p}}return p};sap.m.DateRangeSelection.prototype.setValue=function(v){if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);this._parseValue(v);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype.setFrom=function(f){this.setDateValue(f)};sap.m.DateRangeSelection.prototype.getFrom=function(){return this.getDateValue()};sap.m.DateRangeSelection.prototype.setTo=function(t){this.setSecondDateValue(t)};sap.m.DateRangeSelection.prototype.getTo=function(){return this.getSecondDateValue()};sap.m.DateRangeSelection.prototype.setDateValue=function(d){if(jQuery.sap.equal(this.getDateValue(),d)){return this}this.setProperty("dateValue",d,true);var v=this._formatValue();if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype.setSecondDateValue=function(s){this.setProperty("secondDateValue",s,true);var v=this._formatValue();if(v!==this.getValue()){this._lastValue=v}this.setProperty("value",v,true);if(this.getDomRef()){var o=this._formatValue();if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=this._$input.cursorPos()}}return this};sap.m.DateRangeSelection.prototype._parseValue=function(v){var i="";var f;var d="";if((this.getDelimiter()&&(this.getDelimiter()!==""))&&v){d=v.split(" "+this.getDelimiter()+" ")}if(((!this.getDelimiter()||(this.getDelimiter()===""))&&v)||(this.getDelimiter()&&(this.getDelimiter()!=="")&&v&&d&&(d.length===2))){i=this.getDisplayFormat();if(!i){i="medium"}if(i==="short"||i==="medium"||i==="long"){f=sap.ui.core.format.DateFormat.getInstance({style:i})}else{f=sap.ui.core.format.DateFormat.getInstance({pattern:i})}if((!this.getDelimiter()||(this.getDelimiter()===""))&&v){this.setProperty("dateValue",f.parse(v),true)}else if(d!==""){if((f.parse(d[0])===null)||(f.parse(d[1])===null)){this.setProperty("dateValue",null,true);this.setProperty("secondDateValue",null,true);this.setProperty("value",null,true)}else{this.setProperty("dateValue",f.parse(d[0]),true);this.setProperty("secondDateValue",f.parse(d[1]),true)}}}else{this.setProperty("dateValue",null,true);this.setProperty("secondDateValue",null,true);this.setProperty("value",null,true)}};sap.m.DateRangeSelection.prototype._formatValue=function(d,D){var o;var s;if(d){o=d}else{o=this.getProperty("dateValue")}if(D){s=D}else{s=this.getProperty("secondDateValue")}var v="";if(((!this.getDelimiter()||(this.getDelimiter()===""))&&o)||(this.getDelimiter()&&(this.getDelimiter()!=="")&&o&&s)){var O="";var f;O=this.getDisplayFormat();if(!O){O="medium"}if(O==="short"||O==="medium"||O==="long"){f=sap.ui.core.format.DateFormat.getInstance({style:O})}else{f=sap.ui.core.format.DateFormat.getInstance({pattern:O})}if(this.getDelimiter()&&(this.getDelimiter()!=="")){v=f.format(o)+" "+this.getDelimiter()+" "+f.format(s)}else{v=null}}return v};sap.m.DateRangeSelection.prototype.onChange=function(){if(!this.getEditable()||!this.getEnabled()){return}var d=this.getDateValue();var s=this.getSecondDateValue();var l=this._lastValue;this._getInputValue();a(this,d,s);this._lastValue=l;var v=this._formatValue();if((v!==this._lastValue)||(v==="")){if(this.getDomRef()){this._$input.val(v)}this.setProperty("value",v,true);this._curpos=this._$input.cursorPos();this._setLabelVisibility();this._lastValue=v;if(this._oPopup&&this._oPopup.isOpen()){var S=this.getDateValue();if(S){if(!this._oDateRange.getStartDate()||this._oDateRange.getStartDate().getTime()!==S.getTime()){this._oDateRange.setStartDate(new Date(S.getTime()));this._oCalendar.focusDate(S)}}else{if(this._oDateRange.getStartDate()){this._oDateRange.setStartDate(undefined)}}var e=this.getSecondDateValue();if(e){if(!this._oDateRange.getEndDate()||this._oDateRange.getEndDate().getTime()!==e.getTime()){this._oDateRange.setEndDate(new Date(e.getTime()));this._oCalendar.focusDate(e)}}else{if(this._oDateRange.getEndDate()){this._oDateRange.setEndDate(undefined)}}}_(this)}};sap.m.DateRangeSelection.prototype._getInputValue=function(){var v=this._$input.val();this._parseValue(v);v=this._formatValue();return v};sap.m.DateRangeSelection.prototype._setLabelVisibility=function(){if(!this._bShowLabelAsPlaceholder||!this._$label||!this.isActive()){return}var v=this._$input.val();this._$label.css("display",v?"none":"inline")};sap.m.DateRangeSelection.prototype.onsappageup=function(){};sap.m.DateRangeSelection.prototype.onsappageupmodifiers=function(){};sap.m.DateRangeSelection.prototype.onsappagedown=function(){};sap.m.DateRangeSelection.prototype.onsappagedownmodifiers=function(){};sap.m.DateRangeSelection.prototype._fillDateRange=function(){sap.m.DatePicker.prototype._fillDateRange.apply(this,arguments);var e=this.getSecondDateValue();if(e){if(!this._oDateRange.getEndDate()||this._oDateRange.getEndDate().getTime()!==e.getTime()){this._oDateRange.setEndDate(new Date(e.getTime()))}}else{if(this._oDateRange.getEndDate()){this._oDateRange.setEndDate(undefined)}}};sap.m.DateRangeSelection.prototype._selectDate=function(e){var s=this._oCalendar.getSelectedDates();if(s.length>0){var d=s[0].getStartDate();var D=s[0].getEndDate();if(d&&D){var o=this._formatValue(d,D);if(this._$input.val()!==o){this._$input.val(o);this._setLabelVisibility();this._curpos=o.length;this._$input.cursorPos(this._curpos)}this._oPopup.close();this.focus();this.onChange();if(sap.ui.Device.browser.mobile){window.document.activeElement.blur()}}}};function _(t){t.fireChange({from:t.getDateValue(),to:t.getSecondDateValue()})};function a(t,d,s){var c=t.getDateValue();var e=t.getSecondDateValue();if((c!==null)&&(e!==null)&&(!b(c,e))){if((d!==null)&&(c.getTime()===d.getTime())){t.setProperty("dateValue",e,true)}else if((s!==null)&&(e.getTime()===s.getTime())){t.setProperty("secondDateValue",c,true)}else{t.setProperty("secondDateValue",c,true)}}};function b(f,t){if(f.getTime()<t.getTime()){return true}return false}}());
